# <img src="/src/icon.png" height="25px"> Newtonsoft.Json.Encryption

[![Build status](https://ci.appveyor.com/api/projects/status/qciwf7sdysdeu693/branch/master?svg=true)](https://ci.appveyor.com/project/SimonCropp/newtonsoft-json-encryption)
[![NuGet Status](https://img.shields.io/nuget/v/Newtonsoft.Json.Encryption.svg?label=Newtonsoft.Json.Encryption)](https://www.nuget.org/packages/Newtonsoft.Json.Encryption/)
[![NuGet Status](https://img.shields.io/nuget/v/Rebus.Newtonsoft.Encryption.svg?label=Rebus.Newtonsoft.Encryption)](https://www.nuget.org/packages/Rebus.Newtonsoft.Encryption/)
[![NuGet Status](https://img.shields.io/nuget/v/NServiceBus.Newtonsoft.Encryption.svg?label=NServiceBus.Newtonsoft.Encryption)](https://www.nuget.org/packages/NServiceBus.Newtonsoft.Encryption/)


Leverages the Newtonsoft extension API to encrypt/decrypt specific nodes at serialization time. So only the nodes that require encryption are touched, the remaining content is still human readable. This approach provides an compromise between readability/debugabaility and security.

<!--- StartOpenCollectiveBackers -->

[Already a Patron? skip past this section](#endofbacking)


## Community backed

**It is expected that all developers [become a Patron](https://opencollective.com/nservicebusextensions/contribute/patron-6976) to use this tool. [Go to licensing FAQ](https://github.com/NServiceBusExtensions/Home/#licensingpatron-faq)**

Thanks to the current backers.

<img src="https://opencollective.com/nservicebusextensions/tiers/patron.svg?width=890&avatarHeight=60&button=false">

<a href="#" id="endofbacking"></a>

<!--- EndOpenCollectiveBackers -->

toc


## NuGet packages

  * https://nuget.org/packages/Newtonsoft.Json.Encryption/
  * https://nuget.org/packages/Rebus.Newtonsoft.Encryption/
  * https://nuget.org/packages/NServiceBus.Newtonsoft.Encryption/


## Encryption Algorithms

Any implementation of [SymmetricAlgorithm](https://msdn.microsoft.com/en-us/library/system.security.cryptography.symmetricalgorithm.aspx) is supported.


## Decorating properties

```C#
public class ClassToSerialize
{
    [Encrypt]
    public string Property { get; set; }
}
```


## Serialized

```C#
{
    "Property":"wSayABpFI3g7a/D6gGTq5g=="
}
```


## Supported property types

 * `string`
 * `byte[]`
 * `Guid`
 * `IDictionary<T, string>`
 * `IDictionary<T, byte[]>`
 * `IDictionary<T, Guid>`
 * `IEnumerable<string>`
 * `IEnumerable<byte[]>`
 * `IEnumerable<Guid>`

Note that only the values in a `IDictionary` are encrypted.


## Usage

The full serialize and deserialization workflow:
snippet: Workflow


## Breakdown


### Key

See [SymmetricAlgorithm.Key](https://msdn.microsoft.com/en-us/library/system.security.cryptography.symmetricalgorithm.key.aspx).

Example Key used for [RijndaelManaged algorithm](https://msdn.microsoft.com/en-us/library/system.security.cryptography.rijndaelmanaged.aspx) in the below sample code:

```C#
var key = Encoding.UTF8.GetBytes("gdDbqRpqdRbTs3mhdZh9qCaDaxJXl+e6");
```

A new valid key can be generated by instanitiating a [SymmetricAlgorithm](https://msdn.microsoft.com/en-us/library/system.security.cryptography.symmetricalgorithm.aspx) and accessing [SymmetricAlgorithm.Key](https://msdn.microsoft.com/en-us/library/system.security.cryptography.symmetricalgorithm.key.aspx).


### EncryptionFactory and JsonSerializer

Generally a single instance of `EncryptionFactory` will exist per AppDomain.

A single instance of `EncryptionFactory` is safe to be used for multiple instances of `JsonSerializer`. 

```C#
var factory = new EncryptionFactory();

var serializer = new JsonSerializer
{
    ContractResolver = factory.GetContractResolver()
};
```


### Serialization

A single encrypt session is used per serialization instance.

On instantiation the `SymmetricAlgorithm` will generate a valid [IV](https://msdn.microsoft.com/en-us/library/system.security.cryptography.symmetricalgorithm.iv.aspx). This is generally a good value to use for serialization and then stored for deserialization.

snippet: serialize


### Deserialization

A single decrypt session is used per serialization instance.

 * `key` must be the same as the one use for serialization.
 * `initVector` must be the same as the one use for serialization. It is safe to be transferred with the serialized text. 


snippet: deserialize


## Rebus

snippet: RebugsUsage


## NServiceBus

snippet: NsbUsage


## Release Notes

See [closed milestones](../../milestones?state=closed).


## Icon

[Lock](https://thenounproject.com/term/lock/59296/) designed by [Mourad Mokrane](https://thenounproject.com/molumen/) from [The Noun Project](https://thenounproject.com).